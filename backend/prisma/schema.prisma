datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Papel { 
  MESTRE 
  JOGADOR 
}

model Usuario {
  id          String @id @default(uuid())
  nome        String
  email       String @unique
  senhaHash   String
  papel       Papel
  campanhas   Campanha[]
}

model Campanha {
  id          String @id @default(uuid())
  usuarioId   String
  usuario     Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  nome        String
  descricao   String?
  eventos     Evento[]
  personagens Personagem[]
  locais      Local[]
  objetos     Objeto[]
}

model Evento {
  id         String @id @default(uuid())
  campanhaId String
  campanha   Campanha @relation(fields: [campanhaId], references: [id], onDelete: Cascade)
  titulo     String
  descricao  String?
  ocorridoEm DateTime?
  createdAt  DateTime @default(now())
}

model Personagem {
  id         String @id @default(uuid())
  campanhaId String
  campanha   Campanha @relation(fields: [campanhaId], references: [id], onDelete: Cascade)
  nome       String
  descricao  String?
  createdAt  DateTime @default(now())

  @@index([campanhaId, nome])
}

model Local {
  id         String @id @default(uuid())
  campanhaId String
  campanha   Campanha @relation(fields: [campanhaId], references: [id], onDelete: Cascade)
  nome       String
  descricao  String?
  createdAt  DateTime @default(now())

  @@index([campanhaId, nome])
}

model Objeto {
  id         String @id @default(uuid())
  campanhaId String
  campanha   Campanha @relation(fields: [campanhaId], references: [id], onDelete: Cascade)
  nome       String
  descricao  String?
  createdAt  DateTime @default(now())

  @@index([campanhaId, nome])
}

enum NodoTipo {
  EVENTO
  PERSONAGEM
  LOCAL
  OBJETO
}

enum RelTipo {
  APARECE
  OCORRE_EM
  USA
  TEM
  PARALELO
  ANTERIOR
  POSTERIOR
  VINCULO
}

model Relacao {
  id          String @id @default(uuid())
  origemTipo  NodoTipo
  origemId    String
  destinoTipo NodoTipo
  destinoId   String
  tipo        RelTipo
  createdAt   DateTime @default(now())

  @@unique([origemTipo, origemId, destinoTipo, destinoId, tipo])

  @@index([origemTipo, origemId])
  @@index([destinoTipo, destinoId])

}